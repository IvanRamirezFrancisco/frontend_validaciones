<section class="login-container">
  <div class="login-card">
    <div class="login-header">
      <div class="logo-section">
        <img src="logoP.png" alt="Casa de MÃºsica" class="logo-icon">
        <h1>Bienvenido</h1>
      </div>
      <p class="login-subtitle">Inicia sesiÃ³n en tu cuenta</p>
    </div>

    <!-- Mensaje de bloqueo temporal -->
    @if (isBlocked) {
      <div class="blocked-message" role="alert">
        <i class="warning-icon">ğŸ”’</i>
        <div class="blocked-content">
          <h3>Cuenta bloqueada temporalmente</h3>
          <p>Demasiados intentos fallidos. Intente nuevamente en:</p>
          <div class="countdown">{{ formatTimeRemaining() }}</div>
        </div>
      </div>
    }

    <!-- Mensaje de error general -->
    @if (errorMessage && !isBlocked) {
      <div class="error-message" role="alert">
        <i class="error-icon">âš ï¸</i>
        <span>{{ errorMessage }}</span>
        <button type="button" class="close-error" (click)="clearError()" aria-label="Cerrar error">
          âœ•
        </button>
      </div>
    }

    <!-- Formulario de login -->
    <form [formGroup]="loginForm" class="login-form" novalidate (ngSubmit)="handleLogin()">
      <!-- Selector de tipo de usuario -->
      <div class="form-group">
        <label for="tipo" class="form-label">Tipo de Usuario</label>
        <select 
          id="tipo" 
          formControlName="tipo"
          class="form-control"
          [class.error]="tipo?.touched && tipo?.invalid">
          <option value="Cliente">Cliente</option>
          <option value="Empleado">Empleado</option>
        </select>
        @if (tipo?.touched && tipo?.invalid) {
          <div class="field-error">
            {{ getErrorMessage('tipo') }}
          </div>
        }
      </div>

      <!-- Campo de nombre/usuario -->
      <div class="form-group">
        <label for="nombre" class="form-label">
          {{ loginForm.get('tipo')?.value === 'Cliente' ? 'Nombre completo' : 'Usuario' }}
        </label>
        <div class="input-group">
          <input
            type="text"
            id="nombre"
            formControlName="nombre"
            [placeholder]="loginForm.get('tipo')?.value === 'Cliente' ? 'Ingresa tu nombre completo' : 'Nombre de usuario'"
            class="form-control"
            [class.error]="nombre?.touched && nombre?.invalid"
            [class.success]="nombre?.valid && nombre?.value"
            autocomplete="username"
            [disabled]="isBlocked">
          <i class="input-icon user-icon" 
             [class.error]="nombre?.touched && nombre?.invalid"
             [class.success]="nombre?.valid && nombre?.value">
            <img src="assets/images/usuario.png" alt="Usuario" style="width: 16px; height: 16px;">
          </i>
        </div>
        @if (nombre?.touched && nombre?.invalid) {
          <div class="field-error">
            {{ getErrorMessage('nombre') }}
          </div>
        }
      </div>

      <!-- Campo de contraseÃ±a -->
      <div class="form-group">
        <label for="contrasena" class="form-label">ContraseÃ±a</label>
        <div class="input-group">
          <input
            [type]="showPassword ? 'text' : 'password'"
            id="contrasena"
            formControlName="contrasena"
            placeholder="Ingresa tu contraseÃ±a"
            class="form-control"
            [class.error]="contrasena?.touched && contrasena?.invalid"
            [class.success]="contrasena?.valid && contrasena?.value"
            autocomplete="current-password"
            [disabled]="isBlocked"
            (keypress)="onKeyPress($event)">
          <button
            type="button"
            class="password-toggle"
            (click)="togglePassword()"
            [disabled]="isBlocked"
            [attr.aria-label]="showPassword ? 'Ocultar contraseÃ±a' : 'Mostrar contraseÃ±a'">
            <img [src]="showPassword ? 'assets/images/invisible.png' : 'assets/images/ojo.png'" 
                 [alt]="showPassword ? 'Ocultar' : 'Mostrar'" 
                 style="width: 16px; height: 16px;">
          </button>
        </div>
        @if (contrasena?.touched && contrasena?.invalid) {
          <div class="field-error">
            {{ getErrorMessage('contrasena') }}
          </div>
        }
      </div>

      <!-- Indicador de intentos -->
      @if (loginAttempts > 0 && !isBlocked) {
        <div class="attempts-warning">
          <i class="warning-icon">âš ï¸</i>
          <span>Intentos fallidos: {{ loginAttempts }} / {{ maxAttempts }}</span>
        </div>
      }

      <!-- BotÃ³n de submit -->
      <button
        type="submit"
        class="btn-login"
        [disabled]="isLoading || isBlocked || loginForm.invalid">
        @if (isLoading) {
          <span class="loading-spinner"></span>
          Iniciando sesiÃ³n...
        } @else if (isBlocked) {
          <span class="blocked-icon">ğŸ”’</span>
          Cuenta bloqueada
        } @else {
          Iniciar SesiÃ³n
        }
      </button>
    </form>

    <!-- Demo credentials (solo para empleados) -->
    @if (loginForm.get('tipo')?.value === 'Empleado' && !isBlocked) {
      <div class="demo-section">
        <p class="demo-title">ğŸ¯ Credenciales de prueba:</p>
        <div class="demo-buttons">
          <button 
            type="button" 
            class="demo-btn" 
            (click)="fillDemoCredentials('admin')"
            [disabled]="isLoading">
            <span class="demo-role">ğŸ‘‘</span>
            Admin
          </button>
          <button 
            type="button" 
            class="demo-btn" 
            (click)="fillDemoCredentials('vendedor')"
            [disabled]="isLoading">
            <span class="demo-role">ğŸ›’</span>
            Vendedor
          </button>
          <button 
            type="button" 
            class="demo-btn" 
            (click)="fillDemoCredentials('inventario')"
            [disabled]="isLoading">
            <span class="demo-role">ğŸ“¦</span>
            Inventario
          </button>
        </div>
        <p class="demo-note">ğŸ’¡ Usa cualquier contraseÃ±a para acceder</p>
        <div class="professor-note">
          <strong>ğŸ“ Para el Profesor:</strong><br>
          Cualquier usuario/contraseÃ±a funciona.<br>
          Usuarios desconocidos acceden como Administrador.
        </div>
      </div>
    }

    <!-- Enlaces adicionales -->
    <div class="login-footer">
      <div class="footer-links">
        <a routerLink="/" class="back-link" [class.disabled]="isLoading">
          â† Volver al inicio
        </a>
        <a routerLink="/contacto" class="help-link" [class.disabled]="isLoading">
          Â¿Necesitas ayuda?
        </a>
      </div>
      <div class="register-link">
        <p>Â¿No tienes cuenta? 
          <a routerLink="/registro" class="register-btn" [class.disabled]="isLoading">
            RegÃ­strate aquÃ­
          </a>
        </p>
      </div>
    </div>
  </div>
</section>